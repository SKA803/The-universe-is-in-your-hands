<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>نظام إدارة سجلات المركبات</title>
    <link rel="stylesheet" href="design.css">
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <div class="container">
        <div id="alert-message" class="alert" style="display: none;"></div>
        
        <!-- Toast Notification -->
        <div id="toast" class="toast">
            <i id="toast-icon" class="fas fa-info-circle"></i>
            <span id="toast-message"></span>
        </div>

        <header>
            <h1>نظام إدارة سجلات المركبات</h1>
        </header>

        <!-- Main Companies Page -->
        <div id="companies-page">
            <div class="data-actions">
                <button id="add-company-btn" class="btn btn-primary">
                    <i class="fas fa-plus"></i> إضافة شركة جديدة
                </button>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <h2>قائمة الشركات</h2>
                    <div style="display: flex; gap: 10px;">
                        <div class="search-box" style="flex: 1; max-width: 300px;">
                            <input type="text" id="global-search" class="form-control" placeholder="ابحث برقم الرخصة...">
                            <i class="fas fa-search search-icon"></i>
                        </div>
                    </div>
                </div>
                <div id="companies-list">
                    <!-- Companies will be loaded here -->
                    <div class="spinner-container" style="text-align: center; padding: 20px;">
                        <div class="spinner"></div>
                        <p>جاري تحميل البيانات...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Company Details Page -->
        <div id="company-page" style="display: none;">
            <button id="back-to-companies" class="btn btn-light mb-3">
                <i class="fas fa-arrow-right"></i> العودة إلى الشركات
            </button>
            
            <div class="data-actions">
                <button id="export-company-btn" class="btn btn-success">
                    <i class="fas fa-file-export"></i> تصدير بيانات الشركة
                </button>
                <button id="import-data-btn" class="btn btn-primary">
                    <i class="fas fa-file-import"></i> استيراد بيانات
                </button>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <h2 id="company-name-title">اسم الشركة</h2>
                    <button id="add-vehicle-btn" class="btn btn-primary">
                        <i class="fas fa-plus"></i> إضافة مركبة جديدة
                    </button>
                </div>
                
                <div class="search-box" style="margin-bottom: 20px;">
                    <input type="text" id="company-vehicle-search" class="form-control" placeholder="ابحث برقم الرخصة داخل الشركة...">
                    <i class="fas fa-search search-icon"></i>
                </div>
                
                <div class="stats-container">
                    <div class="stat-card active" id="active-stat">
                        <div class="stat-value" id="active-count">0</div>
                        <div class="stat-label">نشطة</div>
                    </div>
                    <div class="stat-card expiring" id="expiring-stat">
                        <div class="stat-value" id="expiring-count">0</div>
                        <div class="stat-label">قريبة من الانتهاء</div>
                    </div>
                    <div class="stat-card expired" id="expired-stat">
                        <div class="stat-value" id="expired-count">0</div>
                        <div class="stat-label">منتهية</div>
                    </div>
                </div>
                
                <div class="filter-buttons">
                    <button class="btn btn-light filter-btn active" data-filter="all">
                        <i class="fas fa-list"></i> الكل
                    </button>
                    <button class="btn btn-primary filter-btn" data-filter="active">
                        <i class="fas fa-check-circle"></i> نشطة
                    </button>
                    <button class="btn btn-warning filter-btn" data-filter="expiring">
                        <i class="fas fa-exclamation-triangle"></i> قريبة من الانتهاء
                    </button>
                    <button class="btn btn-danger filter-btn" data-filter="expired">
                        <i class="fas fa-times-circle"></i> منتهية
                    </button>
                </div>
                
                <div id="vehicles-list">
                    <table>
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>رقم الرخصة</th>
                                <th>تاريخ انتهاء الرخصة</th>
                                <th>تاريخ انتهاء العيار</th>
                                <th>الحالة</th>
                                <th>الإجراءات</th>
                            </tr>
                        </thead>
                        <tbody id="vehicles-table-body">
                            <!-- Vehicles will be loaded here -->
                        </tbody>
                    </table>
                    <div id="no-vehicles" class="no-data" style="display: none;">لا توجد مركبات مسجلة لهذه الشركة</div>
                </div>
            </div>
        </div>

        <!-- Vehicle Details Page -->
        <div id="vehicle-page" style="display: none;">
            <button id="back-to-company" class="btn btn-light mb-3">
                <i class="fas fa-arrow-right"></i> العودة إلى الشركة
            </button>
            <div class="card">
                <div class="card-header">
                    <h2>تفاصيل المركبة</h2>
                    <div>
                        <button id="edit-vehicle-btn" class="btn btn-primary">
                            <i class="fas fa-edit"></i> تعديل
                        </button>
                        <button id="delete-vehicle-btn" class="btn btn-danger">
                            <i class="fas fa-trash"></i> حذف
                        </button>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>رقم الرخصة:</label>
                    <p id="vehicle-license-number" class="form-control-static"></p>
                </div>
                
                <div class="form-group">
                    <label>تاريخ انتهاء الرخصة:</label>
                    <p id="vehicle-expiry-date" class="form-control-static"></p>
                </div>
                
                <div class="form-group">
                    <label>تاريخ انتهاء العيار:</label>
                    <p id="vehicle-calibration-date" class="form-control-static"></p>
                </div>
                
                <div class="form-group">
                    <label>حالة الرخصة:</label>
                    <p id="vehicle-status" class="form-control-static"></p>
                </div>
                
                <h3>صور الرخصة</h3>
                <div id="vehicle-images" class="gallery">
                    <!-- Images will be loaded here -->
                </div>
                <div id="no-images" class="no-data" style="display: none;">لا توجد صور مرفقة</div>
                
                <h3>الملاحظات</h3>
                <div class="notes-container" id="vehicle-notes">
                    <!-- Notes will be loaded here -->
                </div>
                <div class="form-group">
                    <textarea id="new-note" class="form-control" placeholder="أضف ملاحظة جديدة..."></textarea>
                    <button id="add-note-btn" class="btn btn-primary mt-2">
                        <i class="fas fa-plus"></i> إضافة ملاحظة
                    </button>
                </div>
            </div>
        </div>

        <!-- Add/Edit Vehicle Page -->
        <div id="vehicle-form-page" style="display: none;">
            <button id="back-from-form" class="btn btn-light mb-3">
                <i class="fas fa-arrow-right"></i> العودة
            </button>
            <div class="card">
                <div class="card-header">
                    <h2 id="form-title">إضافة مركبة جديدة</h2>
                </div>
                
                <form id="vehicle-form">
                    <input type="hidden" id="vehicle-id">
                    <input type="hidden" id="company-id">
                    
                    <div class="form-group">
                        <label for="license-number">رقم الرخصة <span class="text-danger">*</span></label>
                        <input type="text" id="license-number" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="expiry-date">تاريخ انتهاء الرخصة (يوم/شهر/سنة) <span class="text-danger">*</span></label>
                        <input type="text" id="expiry-date" placeholder="مثال: 01/12/2023" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="calibration-date">تاريخ انتهاء العيار (يوم/شهر/سنة) (اختياري)</label>
                        <input type="text" id="calibration-date" placeholder="مثال: 01/06/2023">
                    </div>
                    
                    <div class="form-group">
                        <label>صور الرخصة</label>
                        <div id="dropzone" class="dropzone">
                            <p><i class="fas fa-cloud-upload-alt" style="font-size: 24px; margin-bottom: 10px;"></i></p>
                            <p>اسحب وأسقط الصور هنا أو انقر لاختيار الملفات</p>
                            <input type="file" id="file-input" multiple accept="image/*" style="display: none;">
                        </div>
                        <div id="image-preview" class="image-preview">
                            <!-- Preview images will be shown here -->
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <button type="submit" class="btn btn-primary btn-block">
                            <i class="fas fa-save"></i> حفظ البيانات
                        </button>
                        <button type="button" id="cancel-form" class="btn btn-light btn-block">
                            <i class="fas fa-times"></i> إلغاء
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Add Company Modal -->
    <div id="add-company-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>إضافة شركة جديدة</h3>
                <span class="close">&times;</span>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="company-name">اسم الشركة <span class="text-danger">*</span></label>
                    <input type="text" id="company-name" required>
                </div>
            </div>
            <div class="modal-footer">
                <button id="save-company" class="btn btn-primary">
                    <i class="fas fa-save"></i> حفظ
                </button>
                <button id="cancel-company" class="btn btn-light">
                    <i class="fas fa-times"></i> إلغاء
                </button>
            </div>
        </div>
    </div>

    <!-- Edit Company Modal -->
    <div id="edit-company-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>تعديل اسم الشركة</h3>
                <span class="close">&times;</span>
            </div>
            <div class="modal-body">
                <input type="hidden" id="edit-company-id">
                <div class="form-group">
                    <label for="edit-company-name">اسم الشركة <span class="text-danger">*</span></label>
                    <input type="text" id="edit-company-name" required>
                </div>
            </div>
            <div class="modal-footer">
                <button id="update-company" class="btn btn-primary">
                    <i class="fas fa-save"></i> تحديث
                </button>
                <button id="cancel-edit-company" class="btn btn-light">
                    <i class="fas fa-times"></i> إلغاء
                </button>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="delete-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="delete-modal-title">تأكيد الحذف</h3>
                <span class="close">&times;</span>
            </div>
            <div class="modal-body">
                <p id="delete-modal-message">هل أنت متأكد أنك تريد حذف هذا العنصر؟</p>
            </div>
            <div class="modal-footer">
                <button id="confirm-delete" class="btn btn-danger">
                    <i class="fas fa-trash"></i> حذف
                </button>
                <button id="cancel-delete" class="btn btn-light">
                    <i class="fas fa-times"></i> إلغاء
                </button>
            </div>
        </div>
    </div>

    <!-- Export Modal -->
    <div id="export-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="export-modal-title">تصدير البيانات</h3>
                <span class="close">&times;</span>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>اختر نوع التصدير:</label>
                    <select id="export-type" class="form-control">
                        <option value="current-company">الشركة الحالية مع مركباتها</option>
                    </select>
                </div>
                <div class="form-group">
                    <button id="generate-export" class="btn btn-primary btn-block">
                        <i class="fas fa-file-export"></i> توليد ملف التصدير
                    </button>
                </div>
                <div id="export-result" style="display: none;">
                    <div class="form-group">
                        <label>تم توليد ملف التصدير بنجاح:</label>
                        <textarea id="export-data" class="form-control" rows="6" readonly></textarea>
                    </div>
                    <div class="form-group">
                        <button id="download-export" class="btn btn-success btn-block">
                            <i class="fas fa-download"></i> تحميل الملف
                        </button>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="close-export" class="btn btn-light">
                    <i class="fas fa-times"></i> إغلاق
                </button>
            </div>
        </div>
    </div>

    <!-- Import Modal -->
    <div id="import-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="import-modal-title">استيراد البيانات</h3>
                <span class="close">&times;</span>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>اختر ملف JSON للاستيراد:</label>
                    <input type="file" id="import-file" class="form-control" accept=".json">
                </div>
                <div class="form-group">
                    <label>خيارات الاستيراد:</label>
                    <div class="form-check">
                        <input type="checkbox" id="import-overwrite" class="form-check-input">
                        <label for="import-overwrite" class="form-check-label">استبدال البيانات الموجودة</label>
                    </div>
                </div>
                <div id="import-preview" style="display: none; margin-top: 15px;">
                    <h4>معاينة البيانات:</h4>
                    <div id="import-preview-content" class="card" style="max-height: 200px; overflow-y: auto;"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="confirm-import" class="btn btn-primary" disabled>
                    <i class="fas fa-file-import"></i> استيراد البيانات
                </button>
                <button id="cancel-import" class="btn btn-light">
                    <i class="fas fa-times"></i> إلغاء
                </button>
            </div>
        </div>
    </div>

    <!-- Image Lightbox -->
    <div id="lightbox" class="lightbox">
        <span class="lightbox-close">&times;</span>
        <div class="lightbox-nav">
            <span class="lightbox-nav-btn" id="prev-image">&#10094;</span>
            <span class="lightbox-nav-btn" id="next-image">&#10095;</span>
        </div>
        <div class="lightbox-content">
            <img id="lightbox-img" class="lightbox-img" src="">
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/dexie@3.2.1/dist/dexie.min.js"></script>
    <script src="dry.js"></script>
</body>
</html>
